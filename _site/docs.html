<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>lolex</title>
    <meta name="description" content="Fake JavaScript timers" />
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="shortcut icon" href="/assets/images/favicon.png">
    <script>
        var site = {}; // site settings
    </script>

    

    

    
        
    

    <link rel="canonical" href="http://0.0.0.0:4000/docs.html" />
    <link href="https://fonts.googleapis.com/css?family=Karla:400,700" rel="stylesheet">
</head>

<body>
  <div class="navigation">
  <div class="container">
    <nav class="navbar header">
      <div class="navbar-header">
        <a class="navbar-brand" href="/">
          <img class="navbar-logo" src="/assets/images/logo.png" alt="Sinon.JS">
          lolex
        </a>
      </div>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/usage.html">Usage</a></li>
        <li><a href="/api/">Api</a></li>
        <li><a href="https://github.com/sinonjs/lolex" target="blank" class="github-nav"><img src="/assets/images/github.png" alt="Github"></a></li>
      </ul>
    </nav>
  </div>
</div>


  <div class="content">
    <div class="container">
      <h1 id="lolex">lolex</h1>

<p>JavaScript implementation of timing related web APIs.</p>

<p><strong>Implements:</strong></p>

<ul>
  <li><a href="#settimeoutcallback-timeout-args"><code>setTimeout</code></a></li>
  <li><a href="#cleartimeoutid"><code>clearTimeout</code></a></li>
  <li><a href="#setimmediatecallback-args"><code>setImmediate</code></a></li>
  <li><a href="#clearimmediateid"><code>clearImmediate</code></a></li>
  <li><a href="#setintervalcallback-timeout-args"><code>setInterval</code></a></li>
  <li><a href="#clearintervalid"><code>clearInterval</code></a></li>
  <li><a href="#requestanimationframecallback"><code>requestAnimationFrame</code></a></li>
  <li><a href="#cancelanimationframeid"><code>cancelAnimationFrame</code></a></li>
  <li><a href="#date"><code>Date</code></a></li>
  <li><a href="#nexttickcallback-args"><code>nextTick</code></a></li>
  <li><a href="#queuemicrotaskcallback"><code>queueMicrotask</code></a></li>
  <li><a href="#performancenow"><code>performance.now</code></a></li>
</ul>

<p>along with a clock instance that controls the flow of time.
<strong>lolex</strong> also provides a <a href="#date"><code>Date</code></a> implementation that gets its time from the clock.</p>

<p><strong>lolex</strong> can be used to simulate passing time in automated tests and other
situations where you want the scheduling semantics, but don’t want to actually
wait (however, from version 2.0 <strong>lolex</strong> supports those of you who would like to wait too).</p>

<p><strong>lolex</strong> is a part of <a href="https://github.com/sinonjs/sinon.js">Sinon.JS</a>.</p>

<h2 id="installation">Installation</h2>

<pre><code class="language-shell">npm install lolex --save-dev
</code></pre>

<p>You are always free to <a href="https://github.com/sinonjs/lolex/blob/master/package.json#L22">build it yourself</a>, of course.</p>

<h2 id="lolex-api">lolex API</h2>

<h3 id="createclocknow-looplimit"><code>createClock([now[, loopLimit]])</code></h3>

<p>Creates a <a href="#clock-api">clock</a> instance. The default
<a href="https://en.wikipedia.org/wiki/Epoch_%28reference_date%29">epoch</a> is <code>0</code>.</p>

<p>The <code>now</code> argument may be a number (in milliseconds) or a
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date">Date</a> object.</p>

<p>The <code>loopLimit</code> argument sets the maximum number of timers that will be run when calling <code>runAll()</code> before assuming that we have an infinite loop and throwing an error. The default is <code>1000</code>.</p>

<h3 id="installconfig"><code>install([config])</code></h3>

<p>Installs <strong>lolex</strong> using the specified config (otherwise with epoch <code>0</code> on the global scope). The following configuration options are available</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>config.target</code></td>
      <td>Object</td>
      <td>global</td>
      <td>installs <strong>lolex</strong> onto the specified target context</td>
    </tr>
    <tr>
      <td><code>config.now</code></td>
      <td>Number/Date</td>
      <td>0</td>
      <td>installs <strong>lolex</strong> with the specified unix epoch</td>
    </tr>
    <tr>
      <td><code>config.toFake</code></td>
      <td>String[]</td>
      <td>[“setTimeout”, “clearTimeout”, “setImmediate”, “clearImmediate”,”setInterval”, “clearInterval”, “Date”, “requestAnimationFrame”, “cancelAnimationFrame”, “hrtime”]</td>
      <td>an array with explicit function names to hijack. <em>When not set, <strong>lolex</strong> will automatically fake all methods <strong>except</strong> <code>nextTick</code></em> e.g., <code>lolex.install({ toFake: ["setTimeout","nextTick"]})</code> will fake only <code>setTimeout</code> and <code>nextTick</code></td>
    </tr>
    <tr>
      <td><code>config.loopLimit</code></td>
      <td>Number</td>
      <td>1000</td>
      <td>the maximum number of timers that will be run when calling runAll()</td>
    </tr>
    <tr>
      <td><code>config.shouldAdvanceTime</code></td>
      <td>Boolean</td>
      <td>false</td>
      <td>tells <strong>lolex</strong> to increment mocked time automatically based on the real system time shift (e.g. the mocked time will be incremented by 20ms for every 20ms change in the real system time)</td>
    </tr>
    <tr>
      <td><code>config.advanceTimeDelta</code></td>
      <td>Number</td>
      <td>20</td>
      <td>relevant only when using with <code>shouldAdvanceTime: true</code>. increment mocked time by <code>advanceTimeDelta</code> ms every <code>advanceTimeDelta</code> ms change in the real system time.</td>
    </tr>
  </tbody>
</table>

<h3 id="withglobalglobal"><code>withGlobal(global)</code></h3>

<p>In order to support creating clocks based on separate or sandboxed environments (such as JSDOM), <strong>lolex</strong> exports a factory method which takes single argument <code>global</code>, which it inspects to figure out what to mock and what features to support. When invoking this function with a global, you will get back an object with <code>timers</code>, <code>createClock</code> and <code>install</code> - same as the regular <strong>lolex</strong> exports only based on the passed in global instead of the global environment.</p>

<h2 id="clock-api">Clock API</h2>

<h3 id="settimeoutcallback-timeout-args"><code>setTimeout(callback, timeout[, args])</code></h3>

<p>Schedules the callback to be fired once <code>timeout</code> milliseconds have ticked by.</p>

<p>In Node.js <a href="https://nodejs.org/api/timers.html#timers_settimeout_callback_delay_args"><code>setTimeout</code></a> returns a timer object. <strong>lolex</strong> will do the same, however
its <code>ref()</code> and <code>unref()</code> methods have no effect.</p>

<p>In browsers a timer ID is returned.</p>

<h3 id="cleartimeoutid"><code>clearTimeout(id)</code></h3>

<p>Clears the timer given the ID or timer object, as long as it was created using
<code>setTimeout</code>.</p>

<h3 id="setintervalcallback-timeout-args"><code>setInterval(callback, timeout[, args])</code></h3>

<p>Schedules the callback to be fired every time <code>timeout</code> milliseconds have ticked
by.</p>

<p>In Node.js <code>setInterval</code> returns a timer object. <strong>lolex</strong> will do the same, however
its <code>ref()</code> and <code>unref()</code> methods have no effect.</p>

<p>In browsers a timer ID is returned.</p>

<h3 id="clearintervalid"><code>clearInterval(id)</code></h3>

<p>Clears the timer given the ID or timer object, as long as it was created using
<code>setInterval</code>.</p>

<h3 id="setimmediatecallback-args"><code>setImmediate(callback[, args])</code></h3>

<p>Schedules the callback to be fired once <code>0</code> milliseconds have ticked by. Note
that you’ll still have to call <code>clock.tick()</code> for the callback to fire. If
called during a tick the callback won’t fire until <code>1</code> millisecond has ticked
by.</p>

<p>In Node.js <code>setImmediate</code> returns a timer object. <strong>lolex</strong> will do the same,
however its <code>ref()</code> and <code>unref()</code> methods have no effect.</p>

<p>In browsers a timer ID is returned.</p>

<h3 id="clearimmediateid"><code>clearImmediate(id)</code></h3>

<p>Clears the timer given the ID or timer object, as long as it was created using
<code>setImmediate</code>.</p>

<h3 id="requestanimationframecallback"><code>requestAnimationFrame(callback)</code></h3>

<p>Schedules the callback to be fired on the next animation frame, which runs every
16 ticks. Returns an <code>id</code> which can be used to cancel the callback. This is
available in both browser &amp; node environments.</p>

<h3 id="cancelanimationframeid"><code>cancelAnimationFrame(id)</code></h3>

<p>Cancels the callback scheduled by the provided id.</p>

<h3 id="counttimers"><code>countTimers()</code></h3>

<p>Returns the number of waiting timers. This can be used to assert that a test
finishes without leaking any timers.</p>

<h3 id="hrtimeprevtime"><code>hrtime([prevTime])</code></h3>
<p>Mimicks <a href="https://nodejs.org/api/process.html#process_process_hrtime_time"><code>process.hrtime()</code></a>.
Only available in Node.js.</p>

<h3 id="nexttickcallback-args"><code>nextTick(callback[, args])</code></h3>

<p>Mimics <a href="https://nodejs.org/api/process.html#process_process_nexttick_callback_args"><code>process.nextTick</code></a> to enable completely synchronous testing flows.
Only available in Node.js.</p>

<h3 id="performancenow"><code>performance.now()</code></h3>

<p>Implements the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Performance/now"><code>now</code></a> method of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Performance/now"><code>Performance</code></a> object but using the clock to provide the correct time.
Only available in environments that support the Performance object (browsers mostly).</p>

<h3 id="queuemicrotaskcallback"><code>queueMicrotask(callback)</code></h3>

<p>This is essentially a [<code>nextTick</code>] that drops arguments which we already support.</p>

<h3 id="ticktime"><code>tick(time)</code></h3>

<p>Advance the clock, firing callbacks if necessary. <code>time</code> may be the number of
milliseconds to advance the clock by or a human-readable string. Valid string
formats are <code>"08"</code> for eight seconds, <code>"01:00"</code> for one minute and <code>"02:34:10"</code>
for two hours, 34 minutes and ten seconds.</p>

<h3 id="next"><code>next()</code></h3>

<p>Advances the clock to the the moment of the first scheduled timer, firing it.</p>

<h3 id="reset"><code>reset()</code></h3>

<p>Removes all timers and ticks without firing them, and sets <code>now</code> to <code>config.now</code>
that was provided to <code>lolex.install</code> or to <code>0</code> if <code>config.now</code> was not provided.
Useful to reset the state of the clock without having to <code>uninstall</code> and <code>install</code> it.</p>

<h3 id="runall"><code>runAll()</code></h3>

<p>This runs all pending timers until there are none remaining. If new timers are added while it is executing they will be run as well.</p>

<p>This makes it easier to run asynchronous tests to completion without worrying about the number of timers they use, or the delays in those timers.</p>

<p>It runs a maximum of <code>loopLimit</code> times after which it assumes there is an infinite loop of timers and throws an error.</p>

<h3 id="runmicrotasks"><code>runMicrotasks()</code></h3>

<p>This runs all pending microtasks scheduled with <code>nextTick</code> but none of the timers and is mostly useful for libraries using <strong>lolex</strong> underneath and for running <code>nextTick</code> items without any timers.</p>

<h3 id="runtoframe"><code>runToFrame()</code></h3>

<p>Advances the clock to the next frame, firing all scheduled animation frame callbacks,
if any, for that frame as well as any other timers scheduled along the way.</p>

<h3 id="runtolast"><code>runToLast()</code></h3>

<p>This takes note of the last scheduled timer when it is run, and advances the
clock to that time firing callbacks as necessary.</p>

<p>If new timers are added while it is executing they will be run only if they
would occur before this time.</p>

<p>This is useful when you want to run a test to completion, but the test recursively
sets timers that would cause <code>runAll</code> to trigger an infinite loop warning.</p>

<h3 id="setsystemtimenow"><code>setSystemTime([now])</code></h3>

<p>This simulates a user changing the system clock while your program is running.
It affects the current time but it does not in itself cause e.g. timers to fire;
they will fire exactly as they would have done without the call to
setSystemTime().</p>

<h3 id="uninstall"><code>uninstall()</code></h3>

<p>Restores the original methods on the <code>target</code> that was passed to
<code>lolex.install</code>, or the native timers if no <code>target</code> was given.</p>

<h3 id="date"><code>Date</code></h3>

<p>Implements the
<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date"><code>Date</code></a>
object but using the clock to provide the correct time.</p>

    </div>
  </div>

  <script src="/assets/js/prism.js"></script>

<div class="footer">
  <div class="container text-center">
    <a href="http://sinonjs.org/" target="blank"><img class="grow" src="/assets/images/logo.png" alt="Sinon.JS"></a>
    <p><a target="blank" class="join-btn" href="https://stackoverflow.com/questions/tagged/sinon">Join the discussion on Stack Overflow!</a></p>
    <p>Copyright 2010 - 2018, the Sinon.JS committers.</p>
    <p>Released under the <a href="https://opensource.org/licenses/BSD-3-Clause">BSD license</a>.</p>
  </div>
</div>

</body>
</html>
